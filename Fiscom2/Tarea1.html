<head>
    <title>Metodo de Disparo</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="logo.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        html * {
            font-family: Nunito, sans-serif;
        }

        .w-40 {
            width: 40%;
        }

        .wrapper {
            display: grid;
            grid-template-columns: repeat(2, 50%);
            gap: 10px;
        }

        .hide {
            display: none;
        }

        .bb {
            color: #ffffff;
            background-color: #28559a;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-dark bb">
        <a href="#" class="mx-3"><img src="logo.png" alt="" width="50"></a>
        <a class="navbar-brand mx-auto fs-2 fw-bold" href="index.html">Método de Disparo: primeros pasos</a>
    </nav>   
    <div class="m-4">
        <div class="wrapper">
            <div>
                <label for="E-guess" class="fs-5">Valor actual de Energía</label>
                <input id="E-guess" rows="1" class="form-control w-25 my-4" disabled></input>
            </div>
            <button class="btn btn-primary m-2 w-25 fs-4" id="par-toggle" onclick="togglePar()"
                style="max-height: 60px;">Par</button>
        </div>
        <!-- <h1 class="my-2">Seleccione valor de Energía</h1> -->
        <h3>Unidades - Decenas</h3>
        <div class="input-group mb-3">
            <input type="range" class="form-range w-50 px-4" id="range10" min="0" max="10" step="1" value="1"
                oninput="slider();">
            <input type="range" class="form-range w-50 px-4" id="range100" min="0" max="100" step="10" value="0"
                oninput="slider();">
        </div>
        <h3>Centésimas - Millonésimas</h3>
        <div class="input-group mb-3">
            <input type="range" class="form-range w-50 px-4" id="range1" min="0" max="1" step="0.01" value="0"
                oninput="slider();">
            <input type="range" class="form-range w-50 px-4" id="range001" min="0" max="0.01" step="0.0001" value="0"
                oninput="slider();">
        </div>
        <div id="plot" class="w-75 mx-auto"></div>
    </div>
</body>

<script src="https://cdn.plot.ly/plotly-2.18.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
<!-- <script src="17-02.js"></script> -->

<script>
    const EGuess = document.getElementById('E-guess');
    const Range10 = document.getElementById('range10');
    const Range100 = document.getElementById('range100');

    const Range1 = document.getElementById('range1');
    const Range001 = document.getElementById('range001');

    const parBtn = document.getElementById('par-toggle');

    class Wave {
        constructor(N, xmax) {
            this.N = N;
            this.xmax = xmax;
            this.x = [...Array(this.N)].map((_, i) => xmax * i / this.N); // "..." is used for unpack
            this.m = 1;
            this.h = 1;
            this.L = 1;
            this.U = function (x) { return x > this.L ? 1e4 : 0 }; // Single line IF
            // this.U = function (x) {return Math.sin(x);}
            this.psi = this.x.map(xi => 0);
            this.dx = this.x[1] - this.x[2];
        }

        update(par) {
            if (par == true) {
                this.psi[0] = 1;
                this.psi[1] = 1;
            }
            else {
                this.psi[0] = 0;
                this.psi[1] = this.dx;
            }
            for (let i = 2; i < this.psi.length; i++) {
                this.psi[i] = 2 * this.dx ** 2 * (this.U(this.x[i - 1]) - E) * this.psi[i - 1] + 2 * this.psi[i - 1] - this.psi[i - 2]
            }
        }
    }

    let E = 1;
    let par = true;
    EGuess.value = E;
    let xmax = 1.2;
    let wave = new Wave(500, xmax);
    wave.update(par);

    function plot() {
        var trace1 = {
            x: wave.x,
            y: wave.psi,
            type: 'scatter'
        };

        var data = [trace1];

        var layout = {
            xaxis: { range: [0, xmax] },
            yaxis: { range: [-2, 2] }
        };

        Plotly.newPlot('plot', data, layout, { staticPlot: true });
        
        // console.log(wave.psi[wave.psi.length-1]);
    }

    function getSliderVal() {
        E = parseFloat(Range10.value);
        E += parseFloat(Range100.value);
        E += parseFloat(Range1.value);
        E += parseFloat(Range001.value);
        EGuess.value = E;
    }

    getSliderVal();
    wave.update(par);
    plot();


    function slider() {
        getSliderVal();
        wave.update(par);
        plot();
    }

    function togglePar() {
        par = !par;
        if (par == true) {
            parBtn.innerText = 'Par';
        } else {
            parBtn.innerText = 'Impar';
        }
        wave.update(par);
        plot();
    }
</script>